#include <windows.h>
#include <iostream>
#include <string>
#include <wchar.h>
#include <tchar.h>
#pragma comment(lib, "advapi32")

using namespace std;

#define RUN_KEY "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run"

int addRunEntry()

int main()
{
	addRunEntry();
	cin.get();
	cin.get();
	return 0;
}

int addRunEntry()
{
	CHAR path[MAX_PATH];
	int bytes = GetModuleFileNameA(NULL, path, MAX_PATH);
	int size = strlen(path) + 1;
	HKEY newValue;
	if (RegOpenKey(HKEY_CURRENT_USER, TEXT(RUN_KEY), &newValue) != ERROR_SUCCESS) { return -1; }
	if (RegSetValueEx(newValue, TEXT("my_service"), 0, REG_SZ, (LPBYTE)path, MAX_PATH) != ERROR_SUCCESS) {
		RegCloseKey(newValue);
		return -1;
	}
	RegCloseKey(newValue);
	return TRUE;
}
