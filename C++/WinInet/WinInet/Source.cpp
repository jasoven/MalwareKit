#include <iostream>
using namespace std;
#include <stdio.h>
#include "curl.h"
#include<wininet.h>
#include<tchar.h>
#include<string>

#pragma comment (lib, "Wininet.lib")

int main(int argc, char *argv[])
{
	HINTERNET hInternet = InternetOpenW(L"MyUserAgent", INTERNET_OPEN_TYPE_DIRECT, NULL, NULL, 0);

	if (hInternet == NULL)
	{
		std::cout << "InternetOpenW failed with error code " << GetLastError() << std::endl;
	}
	else
	{
		HINTERNET hConnect = InternetConnectW(hInternet, L"70.61.16.8", 50000, NULL, NULL, INTERNET_SERVICE_HTTP, 0, NULL);

		if (hConnect == NULL)
		{
			std::cout << "InternetConnectW failed with error code " << GetLastError() << std::endl;
		}
		else
		{
			const wchar_t* parrAcceptTypes[] = { L"text/*", NULL };
			HINTERNET hRequest = HttpOpenRequestW(hConnect, L"POST", L"/database/api/add_os/", NULL, NULL, parrAcceptTypes, 0, 0);

			if (hRequest == NULL)
			{
				std::cout << "HttpOpenRequestW failed with error code " << GetLastError() << std::endl;
			}
			else
			{
				LPCWSTR hdrs = L"Content-Type: application/x-www-form-urlencoded";
				char here[] = "Content-Type: application/x-www-form-urlencoded";
				char frmdata[] = "mac_address=00-00-00-00-00";
				BOOL bRequestSent = HttpSendRequestW(hRequest, hdrs, strlen(here), frmdata, strlen(frmdata));

				if (!bRequestSent)
				{
					std::cout << "HttpSendRequestW failed with error code " << GetLastError() << std::endl;
				}
				else
				{
					string strResponse;
					const int nBuffSize = 1024;
					char buff[nBuffSize];

					BOOL bKeepReading = true;
					DWORD dwBytesRead = -1;

					while (bKeepReading && dwBytesRead != 0)
					{
						bKeepReading = InternetReadFile(hRequest, buff, nBuffSize, &dwBytesRead);
						strResponse.append(buff, dwBytesRead);
					}

					cout << strResponse << endl;
				}

				InternetCloseHandle(hRequest);
			}

			InternetCloseHandle(hConnect);
		}

		InternetCloseHandle(hInternet);
	}

	return 0;
}