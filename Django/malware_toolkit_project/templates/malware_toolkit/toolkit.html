{% extends 'base.html' %}

{% load staticfiles %}

{% block title %}{{ title }}{% endblock %}

{% block js_1 %}
<script>

function getRadioValueByName(name){
  var ret;
  var radios = document.getElementsByName(name);
  for(i in radios){
    if(radios[i].checked){
      ret = radios[i].value;
      break;
    }
  }
  return ret;
}

function getExeConditions(){
  var vm = getRadioValueByName("detect-vm");
  var vpc = getRadioValueByName("detect-vpc");
  var debug = getRadioValueByName("detect-debugger");
  var procmon = getRadioValueByName("detect-procmon");
  var regshot = getRadioValueByName("detect-regshot");
  var other = getRadioValueByName("detect-these");

  var conds = {};
  conds.vm = vm;
  conds.vpc = vpc;
  conds.debug = debug;
  conds.procmon = procmon;
  conds.regshot = regshot;
  conds.other = other;

  console.log(conds);
}

function it(){
  var csrftoken = getCookie('csrftoken');
  $.ajax({
    type:"GET",
    beforeSend: function (request)
    {
      request.setRequestHeader("X-CSRFToken", csrftoken);
    },
    url: "/malware_toolkit/api/build",
    data: "test",
    success: function(msg) {
      console.log(msg);
    }
  });
}

function getUsersFeatureSelections(){
  var feature_selections = {};
  var groups = document.getElementsByClassName("toolkit-group");

  var group_name;
  var feature_name;
  // iterate over each group
  for(i = 0; i < groups.length; i++){
    group_name = groups[i].getAttribute("name");
    feature_selections[group_name] = {};
    var forms = groups[i].getElementsByTagName("form");

    // iterate over each form (feature) in this group
    for(j = 0; j < forms.length; j++){
      feature = forms[j].id;
      var options = forms[j].getElementsByTagName("input");

      // iterate over each radio button in this form looking for the checked one
      for(k = 0; k < options.length; k++){
        if(options[k].checked){
          feature_selections[group_name][feature] = options[k].value;
        }
      }
    }
  }
  console.log(feature_selections);
}

$(document).ready(function(){
  // document.getElementById('function-name').addEventListener('input', setHeader);
  document.getElementById('build-btn').addEventListener('click', getUsersFeatureSelections);
});

</script>
{% endblock %}

{% block banner %}{{ title }}{% endblock %}

{% block body_block %}
  <div id="top-wrapper">

    <a href="/malware_toolkit/functions">Functions</a>
    <a href="/malware_toolkit/features">Features</a>

    <div style="clear: both"></div>

    <div id="row-1" class="row">
      <!-- begin column 1 -->
      <div id="row-1-c1" class="col-md-4" style="float: left; border: 1px solid black">
        <h4>{{ heading_1 }}</h4>
        <div class="toolkit-group" name="{{ heading_1 }}">
          {% for f in features %}
            {{ f.toolkit_prompt }}:</br>
            <form action="" id="{{ f }}">
              {% for o in f.options %}
              <input type="radio" name="{{ f }}" value="{{ o }}">{{ o }}</input><br>
              {% endfor %}
            </form>
          {% endfor %}
        </div>
        <!-- Detect Virtual Machine:</br>
        <form action="">
          <input type="radio" name="detect-vm" value="yes">Yes</input><br>
          <input type="radio" name="detect-vm" value="no">No</input>
        </form>
        Detect Virtual PC:</br>
        <form action="">
          <input type="radio" name="detect-vpc" value="yes">Yes</input><br>
          <input type="radio" name="detect-vpc" value="no">No</input>
        </form>
        Detect Debugger:</br>
        <form action="">
          <input type="radio" name="detect-debugger" value="yes">Yes</input><br>
          <input type="radio" name="detect-debugger" value="no">No</input>
        </form>
        Detect Process Monitor:</br>
        <form action="">
          <input type="radio" name="detect-procmon" value="yes">Yes</input><br>
          <input type="radio" name="detect-procmon" value="no">No</input>
        </form>
        Detect RegShot:</br>
        <form action="">
          <input type="radio" name="detect-regshot" value="yes">Yes</input><br>
          <input type="radio" name="detect-regshot" value="no">No</input>
        </form>
        Check for These:</br>
        <form action="">
          <input type="radio" name="check-these" value="vm-io-port">VM I/O Port</input><br>
          <input type="radio" name="check-these" value="vm-tools">VM Tools</input>
        </form> -->

      </div>
      <!-- end column 1 -->
      <!-- </br> -->

      <!-- begin column 2 -->
      <div id="row-1-c2" class="col-md-4" style="float: left; border: 1px solid red">
        <h4>{{ heading_2 }}</h4>
        <div class="toolkit-group" name="{{ heading_2 }}">
          Make Startup Process:</br>
          <form action="">
            <input type="radio" name="make-startup" value="yes">Yes</input><br>
            <input type="radio" name="make-startup" value="no">No</input>
          </form>
          Pack Executable:</br>
          <form action="">
            <input type="checkbox" name="packing" value="yes">Yes</input>
            <input type="radio" name="packing-type" value="upx">UPX</input><br>
            <input type="radio" name="packing-type" value="other">Other</input>
          </form>

          </br>
          On Failed Exec. Conditions:</br>
          <form action="">
              <input type="radio" name="on-failed" value="kill-destroy">Kill and Destroy</input><br>
              <input type="radio" name="on-failed" value="kill">Kill</input><br>
              <input type="radio" name="on-failed" value="ignore">Ignore
          </form>
        </div>
      </div>
      <!-- end column 2 -->

      <!-- begin column 3 -->
      <div id="row-1-c3" class="col-md-4" style="float: left; border: 1px solid green">
        <h4>{{ heading_3 }}</h4>
        <div class="toolkit-group" name="{{ heading_3 }}">
          <form action="">
            <input type="radio" name="action-sequence" value="key-log">Log Keystrokes</input><br>
            <input type="radio" name="action-sequence" value="check-reg">Check Registry</input><br>
            <input type="radio" name="action-sequence" value="mod-reg">Modify Registry</input>
            <input type="radio" name="action-sequence" value="listen-for-action">Listen to Botmaster</input>
            <input type="radio" name="action-sequence" value="none">None</input>
          </form>
        </div>
      </div>
      <!-- end column 3 -->
    </div>
    <div style="clear: both"></div>
    <!-- close row-1 -->

    <div id="row-2">
      <div id="row-2-c1" style="float: left" class="btn-group">
        <button id="clear-btn" class="btn btn-primary">Clear</button>
        <button id="build-btn" class="btn btn-primary">Build</button>
        <button id="download-btn" class="btn btn-primary">Download</button>
      </div>
    </div>
    <div style="clear: both"></div>
    <!-- close row-2 -->

  </div>
  <!-- close top-wrapper -->
{% endblock %}
