{% extends 'base.html' %}

{% load staticfiles %}

{% block title %}{{ title }}{% endblock %}

{% block js_1 %}
<script>

function getRadioValueByName(name){
  var ret;
  var radios = document.getElementsByName(name);
  for(i in radios){
    if(radios[i].checked){
      ret = radios[i].value;
      break;
    }
  }
  return ret;
}

function sendBuildRequest(){
  var csrftoken = getCookie('csrftoken');
  $.ajax({
    type:"POST",
    beforeSend: function (request)
    {
      request.setRequestHeader("X-CSRFToken", csrftoken);
    },
    url: "/malware_toolkit/api/build/",
    data: getUsersSelections(),
    success: function(msg) {
      console.log(msg);
    }
  });
}

function clearUsersSelections(){
  var groups = document.getElementsByClassName("toolkit-group");

  for(i = 0; i < groups.length; i++){
    var forms = groups[i].getElementsByTagName("form");

    // iterate over each form (feature) in this group
    for(j = 0; j < forms.length; j++){
      var options = forms[j].getElementsByTagName("input");

      // iterate over each radio button in this form looking for the checked one
      for(k = 0; k < options.length; k++){
        options[k].checked = false;
      }
    }
  }
}

function getUsersSelections(){
  var feature_selections = {};
  var groups = document.getElementsByClassName("toolkit-group");
  var group_name;
  var feature_name;
  // iterate over each group
  for(i = 0; i < groups.length; i++){
    group_name = groups[i].getAttribute("name");
    feature_selections[group_name] = [];
    var forms = groups[i].getElementsByTagName("form");

    // iterate over each form (feature) in this group
    for(j = 0; j < forms.length; j++){
      feature = forms[j].id;
      var options = forms[j].getElementsByTagName("input");

      // iterate over each radio button in this form looking for the checked one
      for(k = 0; k < options.length; k++){
        if(options[k].checked){
          feature_selections[group_name].push(feature);
        }
      }
    }
  }
  // console.log(feature_selections);
  return feature_selections;
}

$(document).ready(function(){
  // document.getElementById('function-name').addEventListener('input', setHeader);
  document.getElementById('clear-btn').addEventListener('click', clearUsersSelections);
  // document.getElementById('build-btn').addEventListener('click', getUsersSelections);
  document.getElementById('build-btn').addEventListener('click', sendBuildRequest);
});

</script>
{% endblock %}

{% block banner %}{{ title }}{% endblock %}

{% block body_block %}
  <div id="top-wrapper">

    <a href="/malware_toolkit/functions">Functions</a>
    <a href="/malware_toolkit/features">Features</a>

    <div style="clear: both"></div>

    <div id="row-1" class="row">
      <!-- begin column 1 -->
      <div id="row-1-c1" class="col-md-4" style="float: left; border: 1px solid black">
        <h4>{{ type_1 }}s</h4>
        <div class="toolkit-group" name="{{ type_1 }}">
          {% for f in features_1 %}
            {{ f.toolkit_prompt }}:</br>
            <form action="" id="{{ f }}">
              {% for o in f.options %}
              <input type="checkbox" name="{{ f }}" value="{{ o }}">{{ o }}</input><br>
              {% endfor %}
            </form>
          {% endfor %}
        </div>
      </div>
      <!-- end column 1 -->

      <!-- begin column 2 -->
      <div id="row-1-c2" class="col-md-4" style="float: left; border: 1px solid red">
        <h4>{{ type_2 }}s</h4>
        <div class="toolkit-group" name="{{ type_2 }}">
          {% for f in features_2 %}
            {{ f.toolkit_prompt }}:</br>
            <form action="" id="{{ f }}">
              {% for o in f.options %}
              <input type="checkbox" name="{{ f }}" value="{{ o }}">{{ o }}</input><br>
              {% endfor %}
            </form>
          {% endfor %}
        </div>
      </div>
      <!-- end column 2 -->

      <!-- begin column 3 -->
      <div id="row-1-c3" class="col-md-4" style="float: left; border: 1px solid green">
        <h4>{{ type_3 }}s</h4>
        <div class="toolkit-group" name="{{ type_3 }}">
          {% for f in features_3 %}
            {{ f.toolkit_prompt }}:</br>
            <form action="" id="{{ f }}">
              {% for o in f.options %}
              <input type="checkbox" name="{{ f }}" value="{{ o }}">{{ o }}</input><br>
              {% endfor %}
            </form>
          {% endfor %}
        </div>
      </div>
      <!-- end column 3 -->
    </div>
    <div style="clear: both"></div>
    <!-- close row-1 -->

    <div id="row-2">
      <div id="row-2-c1" style="float: left" class="btn-group">
        <button id="clear-btn" class="btn btn-primary">Clear</button>
        <button id="build-btn" class="btn btn-primary">Build</button>
        <button id="download-btn" class="btn btn-primary">Download</button>
      </div>
    </div>
    <div style="clear: both"></div>
    <!-- close row-2 -->

  </div>
  <!-- close top-wrapper -->
{% endblock %}
